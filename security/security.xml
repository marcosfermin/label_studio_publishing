<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- Module Categories -->
    <record id="module_category_label_studio_publishing" model="ir.module.category">
        <field name="name">Label Studio Publishing</field>
        <field name="description">Music Industry Management</field>
        <field name="sequence">20</field>
    </record>

    <!-- Security Groups -->
    
    <!-- Label Executive / Admin -->
    <record id="group_label_exec" model="res.groups">
        <field name="name">Label Executive / Admin</field>
        <field name="category_id" ref="module_category_label_studio_publishing"/>
        <field name="comment">Full access to all label operations including financials</field>
        <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
    </record>

    <!-- A&R Manager -->
    <record id="group_anr_manager" model="res.groups">
        <field name="name">A&R Manager</field>
        <field name="category_id" ref="module_category_label_studio_publishing"/>
        <field name="comment">Manage A&R pipeline, deals, and catalog - no financial access</field>
        <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
    </record>

    <!-- Royalty Accountant -->
    <record id="group_royalty_accountant" model="res.groups">
        <field name="name">Royalty Accountant</field>
        <field name="category_id" ref="module_category_label_studio_publishing"/>
        <field name="comment">Import statements, process royalties, generate payments</field>
        <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
    </record>

    <!-- Studio Manager -->
    <record id="group_studio_manager" model="res.groups">
        <field name="name">Studio Manager</field>
        <field name="category_id" ref="module_category_label_studio_publishing"/>
        <field name="comment">Manage studio operations, bookings, pricing, invoices</field>
        <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
    </record>

    <!-- Studio Staff -->
    <record id="group_studio_staff" model="res.groups">
        <field name="name">Studio Staff</field>
        <field name="category_id" ref="module_category_label_studio_publishing"/>
        <field name="comment">View bookings, log sessions, equipment usage</field>
        <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
    </record>

    <!-- Publishing Manager -->
    <record id="group_publishing_manager" model="res.groups">
        <field name="name">Publishing Manager</field>
        <field name="category_id" ref="module_category_label_studio_publishing"/>
        <field name="comment">Manage works, splits, registrations, sync licensing</field>
        <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
    </record>

    <!-- Portal Groups -->
    <record id="group_artist_portal" model="res.groups">
        <field name="name">Artist Portal</field>
        <field name="category_id" ref="module_category_label_studio_publishing"/>
        <field name="comment">Artists can view their own profile, statements, bookings</field>
        <field name="implied_ids" eval="[(4, ref('base.group_portal'))]"/>
    </record>

    <record id="group_writer_portal" model="res.groups">
        <field name="name">Writer Portal</field>
        <field name="category_id" ref="module_category_label_studio_publishing"/>
        <field name="comment">Writers can view their works, splits, statements</field>
        <field name="implied_ids" eval="[(4, ref('base.group_portal'))]"/>
    </record>

    <!-- Record Rules -->
    
    <!-- Partner Portal Rules -->
    <record id="rule_partner_portal_own" model="ir.rule">
        <field name="name">Partners: Portal users can only see own record</field>
        <field name="model_id" ref="base.model_res_partner"/>
        <field name="domain_force">[('id', '=', user.partner_id.id)]</field>
        <field name="groups" eval="[(4, ref('group_artist_portal')), (4, ref('group_writer_portal'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Deal Portal Rules -->
    <record id="rule_deal_portal_own" model="ir.rule">
        <field name="name">Deals: Portal users can only see own deals</field>
        <field name="model_id" ref="model_label_deal"/>
        <field name="domain_force">[('party_id', '=', user.partner_id.id)]</field>
        <field name="groups" eval="[(4, ref('group_artist_portal')), (4, ref('group_writer_portal'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Royalty Statement Portal Rules -->
    <record id="rule_royalty_statement_portal_own" model="ir.rule">
        <field name="name">Royalty Statements: Portal users can only see own statements</field>
        <field name="model_id" ref="model_royalty_statement"/>
        <field name="domain_force">[('party_id', '=', user.partner_id.id)]</field>
        <field name="groups" eval="[(4, ref('group_artist_portal')), (4, ref('group_writer_portal'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Studio Booking Portal Rules -->
    <record id="rule_studio_booking_portal_own" model="ir.rule">
        <field name="name">Studio Bookings: Portal users can only see own bookings</field>
        <field name="model_id" ref="model_studio_booking"/>
        <field name="domain_force">[('client_id', '=', user.partner_id.id)]</field>
        <field name="groups" eval="[(4, ref('group_artist_portal'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Work Portal Rules for Writers -->
    <record id="rule_work_writer_portal_own" model="ir.rule">
        <field name="name">Works: Writers can only see works they wrote</field>
        <field name="model_id" ref="model_music_work"/>
        <field name="domain_force">[('composer_ids', 'in', user.partner_id.id)]</field>
        <field name="groups" eval="[(4, ref('group_writer_portal'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Multi-company Rules -->
    <record id="rule_deal_multi_company" model="ir.rule">
        <field name="name">Deals: Multi-company rule</field>
        <field name="model_id" ref="model_label_deal"/>
        <field name="domain_force">['|', ('label_entity_id', '=', False), ('label_entity_id', 'in', company_ids)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
    </record>

    <record id="rule_usage_line_multi_company" model="ir.rule">
        <field name="name">Usage Lines: Multi-company rule</field>
        <field name="model_id" ref="model_royalty_usage_line"/>
        <field name="domain_force">['|', ('company_id', '=', False), ('company_id', 'in', company_ids)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
    </record>

    <!-- Studio Staff Rules -->
    <record id="rule_studio_booking_staff_read" model="ir.rule">
        <field name="name">Studio Bookings: Staff can read all bookings</field>
        <field name="model_id" ref="model_studio_booking"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('group_studio_staff'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <!-- A&R Manager Rules -->
    <record id="rule_anr_lead_manager" model="ir.rule">
        <field name="name">A&R Leads: Managers can see all</field>
        <field name="model_id" ref="model_label_anr_lead"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('group_anr_manager')), (4, ref('group_label_exec'))]"/>
    </record>

    <record id="rule_deal_anr_no_financials" model="ir.rule">
        <field name="name">Deals: A&R can see deals but limited financial fields</field>
        <field name="model_id" ref="model_label_deal"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('group_anr_manager'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Publishing Manager Rules -->
    <record id="rule_work_publishing_manager" model="ir.rule">
        <field name="name">Works: Publishing managers can see all</field>
        <field name="model_id" ref="model_music_work"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('group_publishing_manager')), (4, ref('group_label_exec'))]"/>
    </record>

    <!-- Executive Full Access Rules -->
    <record id="rule_label_exec_all_access" model="ir.rule">
        <field name="name">Label Executive: Full access to all records</field>
        <field name="model_id" ref="model_label_deal"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('group_label_exec'))]"/>
    </record>

    <!-- Royalty Accountant Rules -->
    <record id="rule_usage_line_accountant" model="ir.rule">
        <field name="name">Usage Lines: Royalty accountants can see all</field>
        <field name="model_id" ref="model_royalty_usage_line"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('group_royalty_accountant')), (4, ref('group_label_exec'))]"/>
    </record>

    <record id="rule_royalty_statement_accountant" model="ir.rule">
        <field name="name">Royalty Statements: Royalty accountants can see all</field>
        <field name="model_id" ref="model_royalty_statement"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('group_royalty_accountant')), (4, ref('group_label_exec'))]"/>
    </record>

</odoo>